<create-physical>

  <div style="margin-top:100px">
    <form name="createPhysicalForm" class="col s12" onsubmit={submitForm}>
      <p>
        Barcode: <a class="waves-effect waves-light btn" onclick={scanItem}>scan</a> or <a class="waves-effect waves-light btn" onclick={createLabel}>create label</a>
      </p>
      <p>
         Location: <a class="waves-effect waves-light btn" onclick={scanContainer}>scan container</a>
      </p>
      <form-textarea-input label="Notes" name="notes" value={formData.notes}/>
      <std-button label="submit" action={submitForm} />
      <input type="submit" style="visibility:hidden" />
    </form>

    <div id="scanModal" class="scanModal modal">

    </div>
  </div>
  <script>
    /*
       * add keyboard capture scanning to scan modal
       * add print modal and make it actually print
       * link create-physical from create-form
       * link create (virtual) from create-form
       * make create-physical actually save to db
       * make create-physical capable of editing
       * add Tim's physicals list to materials

       * get normal search working
       * get inventory search working


       * ensure date/time and author are always saved
       * ensure access control works
    */


    this.scanItem = function() {
      var opts = {
        title: "Scan",
        subtitle: "Scan the item's barcode",
        subTag: "scan",
        cb: function(err, id) {
          console.log("CODE CALLBACK", err, id);
          $(self.scanModal).closeModal();
          tags[0].unmount(true)
        }
      }
      var tags = riot.mount('#scanModal', 'modal-content', opts)

      $(self.scanModal).openModal({
        complete: function() { 
          tags[0].unmount(true)
        }
      })
    }

    this.scanContainer = function() {
      var opts = {
        title: "Scan location",
        subtitle: "Scan the barcode of e.g. the box or freezer where you put this item",
        subTag: "scan",
        cb: function(err, id) {
          console.log("CODE CALLBACK", err, id);
          $(self.scanModal).closeModal();
          tags[0].unmount(true)
        }
      }
      var tags = riot.mount('#scanModal', 'modal-content', opts)

      $(self.scanModal).openModal({
        complete: function() { 
          tags[0].unmount(true)
        }
      })
    }


  </script>
</create-physical>


<modal-content>
  <div>
    <div class="modal-content">
      <h4>{opts.title}</h4>
      <p>{opts.subtitle}</p>
      <div id="modalContents"></div>
    </div>
<!--
    <div class="modal-footer">
      <a href="#!" class=" modal-action modal-close waves-effect waves-green btn-flat">Agree</a>
    </div>
-->
  </div>

  <script>

    var tags;

    this.on('mount', function() {
      tags = riot.mount('#modalContents', this.opts.subTag, this.opts);
    })

    this.on('before-unmount', function() {
      tags[0].unmount()
    })

  </script>
</modal-content>
