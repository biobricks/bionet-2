<create-part>
  <content-container style="padding-top:165px;">
    <section-container>
      <div id="create-part-content" class="{theme.style.color.background} {theme.style.color.text}">
        <create-specification />
      </div>
    </section-container>
  </content-container>
  <script>

    this.on('mount', function() {

      if(!self.formData) {
        self.formData = {};
      }
      if(this.opts.query && this.opts.query.name && this.opts.query.name.trim()) {
        self.formData.name = decodeURIComponent(this.opts.query.name);
        this.update();
        $.extend(app.state.createPart, $.formToObject(self.createPartForm))
      }

    });


    // setup secondary nav
    app.dispatch(app.$.secondaryNav, [{
        label: 'specifications',
        icon: undefined,
        action: '/create-virtual/' + this.opts.type
    }, {
        label: 'sequence',
        icon: undefined,
        action: '/create-virtual/' + this.opts.type + '/?tab=sequence'
    }, {
        label: 'physical instance',
        icon: undefined,
        action: '/create-virtual/' + this.opts.type + '/?tab=instances'
    }])

    // initialize breadcrumbs
    app.dispatch(app.$.breadcrumbs, [{
      'label': 'inventory',
      'url': '/'
      }, {
      'label': 'create part',
      'url': '#'
    }]);

    // configure app bar
    app.dispatch(app.$.appBarConfig, {
      enableTopNav: true,
      enableBreadCrumbs: true,
      enableSubbar: true
    })



  </script>
</create-part>

<create-specification>
  <form name="createPartForm" class="col s12" onsubmit={submitForm}>
    <form-text-input label="Part Name" name="name" value={formData.name}/>
    <form-textarea-input label="Description" name="description" value={formData.description}/>
    <form-text-input label="Created by" name="creator" value={formData.creator}/>
    <form-text-input label="Created" name="created" value={formData.created}/>
    <form-text-input label="Storage temperature" name="temperature" value={formData.temperature}/>
    <form-textarea-input label="Biosafety level" name="bsl" value={formData.bsl}/>
    <form-switch label="Biohazardous?" name="biohazard" value={formData.biohazard} options={[ 'No', 'Yes']}/>
    <form-image imagesrc={formData.avatar} label="Avatar" height="60px" />
    <form-text-input label="" name="avatar" value={formData.avatar}/>
    <std-button label="submit" action={submitForm} />
    <input type="submit" style="visibility:hidden" />
  </form>
  <script>

    self.formData = app.state.createPart
    app.state.createPart = app.state.createPart || {}

    // TODO JUUl this doesn't work if using $(self.createPartForm)
    // probably because it needs to be run from within on('mount')

    $(this.createPartForm).change(function(e) {
      $.extend(app.state.createPart, $.formToObject(self.createPartForm))
    }.bind(this));

    self.submitForm = function(e) {

      app.remote.saveVirtual(app.state.createPart, function(err, id) {
        if(err) return app.ui.toast("Error: " + err) // TODO handle error
        
        app.ui.toast("Virtual created with ID: " + id)

        riot.route('/edit/' + id);
      });

    }

  </script>
</create-specification>


<create-sequence>
  <form-container action={submitForm}>
    <form-textarea-input label="DNA Sequence" name="sequence" value={formData.sequence}/>
    <std-button action={parent.submitForm} label="submit" />
    <input type="submit" style="visibility:hidden" />
  </form-container>
  <script>
    app.state.createPart = app.state.createPart || {}

    self.submitForm = function(e) {
      console.log("SUBMIT seq");
    }

  </script>
</create-sequence>

<create-instance>
  <form-container>
    <form-text-input label="Physical Location Code" name="location" value={formData.location}/>
    <form-text-input label="Datamatrix Code" name="datamatrix" value={formData.qrcode}/>
    <form-image imagesrc={formData.qrcode} label="Datamatrix code" height="140px" />
    <std-button action={submitForm3} label="submit" />
  </form-container>
  <script>

//    self.submitForm = function() {

//    }

  </script>
</create-instance>
